- job-template:
    name: '{name}_checkbox_job'
    description: 'Automatically generated test'
    project-type: freestyle
    builders:
      - shell: |
             rm -rf *
             git clone https://github.com/CSC-DevOps/TestGeneration.git
             cd TestGeneration/
             npm install istanbul -G
             npm install
             npm test
    publishers:
      - html-publisher:
          name: 'Checkbox'
          dir: 'TestGeneration/coverage/lcov-report/TestGeneration'
          files: 'subject.js.html'

- job-template:
    name: '{name}_itrust_job'
    description: 'Automatically generated test'
    project-type: freestyle
    builders:
      - shell: |
             rm -rf *
             git clone https://{{ lookup('env', 'GITHUB_USERNAME') }}:{{ lookup('env', 'GITHUB_PASSWORD') }}@github.ncsu.edu/tmdement/iTrust2-v2.git
             cd iTrust2-v2/iTrust2/
             cp src/main/java/db.properties.template src/main/java/db.properties
             cp src/main/resources/hibernate.properties.template src/main/resources/hibernate.properties
             cp  src/main/java/email.properties.template src/main/java/email.properties
             sed -i -e 's/hibernate.connection.password = /hibernate.connection.password = root/g' src/main/resources/hibernate.properties
             sed -i -e 's/password/password root/g' src/main/java/db.properties
             mvn clean test verify checkstyle:checkstyle
    publishers:
      - jacoco:
          exec-pattern: '**/**.exec'
          class-pattern: '**/classes'
          source-pattern: '**/src/main/java'
          update-build-status: false
          inclusion-pattern: ''
          exclusion-pattern: ''
          targets:
            - instruction:
                healthy: 0
                unhealthy: 0
            - branch:
                healthy: 0
                unhealthy: 0
            - complexity:
                healthy: 0
                unhealthy: 0
            - line:
                healthy: 0
                unhealthy: 0
            - method:
                healthy: 0
                unhealthy: 0
            - class:
                healthy: 0
                unhealthy: 0

- job-group:
    name: '{name}_job'
    jobs:
      - '{name}_checkbox_job'
      - '{name}_itrust_job'

    # publishers:
    #   - post-tasks:
    #     - matches:
    #       - log-text: git clone
    #         operator: AND
    #       escalate-status: true
    #       run-if-job-successful: true
    #       script: '{post_build_script}'